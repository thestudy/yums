<script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="calendar-block.html">

<dom-module id="calendar-view">
    
    <style>
    </style>
    
    <template>
        <div class="horizontal layout">
            <template is="dom-repeat" id="daylist" items="{{calendar}}" as="day">
                <div class="vertical layout">
                    <span>{{day.day}}</span>
                    <template is="dom-repeat" items="{{day.values}}" as="block">
                        <span>{{block}}</span>
                    </template>
                </div>
            </template>
        </div>
    </template>
    
    <script>
        Polymer({
            is: "calendar-view",
            
            properties: {
                selectorColor: String,
                selectedColor: String,
                view: Boolean,
                dayMin: String,
                dayMax: String,
                hourMin: Number,
                minuteMin: Number,
                hourMax: Number,
                minuteMax: Number,
                blockInterval: Number,
                calendar: Array
            },
            
            updateCalendar: function() {
                console.log("Updating");
                this.dayMin = "0";
                this.hourMin = 14;
                this.minuteMin = 15;
                this.hourMax = 22;
                this.minuteMax = 0;
                this.blockInterval = 30;
                this.dayMax = "6";
                this.calendar = this.getCalendar(this.dayMin, this.dayMax, this.hourMin, this.hourMax, this.minuteMin, this.minuteMax, this.blockInterval);
            },
            
            getCalendar: function(dayMin, dayMax, hourMin, hourMax, minuteMin, minuteMax, blockInterval) {
                var calendar = [];
                
                var i;
                for (i = Number(dayMin); i <= Number(dayMax); i++) {
                    var day = {};
                    day.day = this.getDayName(i);
                    day.values = [];
                    
                    var hour = hourMin;
                    var min = minuteMin;
                    
                    
                    while (this.getTime(hour, min) < this.getTime(hourMax, minuteMax)) {
                        day.values.push(this.getTime(hour, min));
                        var t = this.nextBlock(hour, min, blockInterval);
                        hour = t.hour;
                        min = t.min;
                        console.log(this.getTime(hour, min));
                    }
                    
                    calendar.push(day);
                }
                
                return calendar;
            },
            
            getDayName: function(numDay) {
                switch (Number(numDay)) {
                    case 0:
                        return "Sunday";
                    case 1:
                        return "Monday";
                    case 2:
                        return "Tuesday";
                    case 3:
                        return "Wednesday";
                    case 4:
                        return "Thursday";
                    case 5:
                        return "Friday";
                    case 6:
                        return "Saturday";
                }
            },
            
            nextBlock: function(hour, minute, blockInterval) {
                minute += blockInterval;
                if (minute >= 60) {
                   hour++;
                   minute -= 60;
                }
               
               return {
                   hour: hour,
                   min: minute
               };
            },
            
            getTime: function(hour, minute) {
                
               var hourt = (hour < 10) ? "0" + String(hour) : String(hour);
               var minutet = (minute < 10) ? "0" + String(minute) : String(minute);
               
               return hourt + ":" + minutet;
            }
        });
    </script>
    
</dom-module>